<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Document</title>
  <link rel="stylesheet" href="./css/index.css" />
  <link rel="stylesheet" href="./css/player.css" />
  <link rel="stylesheet" href="./css/results.css" />
  <link rel="stylesheet" href="./css/video.css" />
  <link rel="stylesheet" href="./css/comment.css" />
  <link rel="stylesheet" href="./css/iconfont.css" />
</head>

<body>
  <div id="player">
    <h2 class="title" v-cloak>{{msg}}</h2>
    <div class="search">
      <input type="text" v-model.trim="query" @keyup.enter="searchMusic" />
      <button @click="searchMusic">
        <span class="iconfont icon-search"></span>
      </button>
    </div>
    <p class="result">
    </p>
    <ul class="tab-wrapper">
      <!-- tabæ  -->
      <ul class="tab-bar">

        <router-link active-class="active" class="bar-item " to="/search">æœç´¢ç»“æœ</router-link>

        <router-link active-class="active" class="bar-item" to="/play"> æ­Œæ›²æ’­æ”¾</router-link>

        <router-link active-class="active" class="bar-item" to="/mv"> æ­Œæ›²MV</router-link>

        <router-link active-class="active" class="bar-item" to="/comment"> æ­Œæ›²è¯„è®º</router-link>

        <router-link active-class="active" class="bar-item" to="/recommendedSongs" > æ¨èæ­Œæ›²</router-link>

      </ul>
      <!-- å¯¹åº”çš„å†…å®¹åŒºåŸŸ -->
      <div class="tab-content">
        <!-- è·¯ç”±å‡ºå£ -->
        <!-- è·¯ç”±åŒ¹é…åˆ°çš„ç»„ä»¶å°†æ¸²æŸ“åœ¨è¿™é‡Œ -->
        <router-view></router-view>
      </div>
    </ul>
  </div>
</body>

</html>
<script src="./lib/vue.js"></script>
<!-- axios é˜¿è¥¿å¥¥æ–¯ -->
<!-- <script src="https://unpkg.com/axios/dist/axios.min.js"></script> -->
<script src="./lib/axios.js"></script>

<!-- <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script> -->
<script src="./lib/vue-router.js"></script>


<!-- ç»„ä»¶1 æ­Œæ›²æœç´¢ -->
<script type="text/html" id="search01">
  <div class="content-item">
    <div class="result-wrapper">

      <div class="song" v-for="(item, index) in musicList" :key="index">
        <div class="name"><span class="iconfont icon-play" @click="toPlay(item.id)"></span>
          {{item.name}}
          <span class="iconfont icon-editmedia" @click="toMv(item.mvid)" v-show="item.mvid!=0"></span></div>
        <div class="singer">{{ item.artists | singeres}}</div>
        <div class="album">ã€Š{{ item.album.name }}ã€‹</div>
        <div class="time">{{ item.duration}}</div>
      </div>


    </div>
  </div>
</script>


<!-- ç»„ä»¶2  æ­Œæ›²æ’­å‘ -->
<script type="text/html" id="play01">
  <div class="content-item" style="">
    <div class="player">
      <div class="left"><img src="./img/disc.png" alt="" class="disc " :class="{loading:isloading}">
        <img :src="imgSrc?imgSrc:'./img/cover.png'" alt="" class="cover">
      </div>
      <div class="right">
        <div class="title"><img src="./img/tag.png" alt=""><span>{{ musicName}}</span></div>
        <div class="singer">æ­Œæ‰‹: <span>{{ singerName}}</span></div>
        <div class="album">æ‰€å±ä¸“è¾‘: <span>{{ specialName }}</span></div>
        <p>æŸ¥çœ‹è¯„è®º</p>

        

        <audio controls="controls" :src="musicUrl" class="audio" autoplay loop  @play="play" @pause="pause"></audio>
        <ul class="lyric-container">
          <li class="lyric" v-for="(item, index) in lyrics" :key="index">{{item}}</li>

        </ul>
      </div>
    </div>
  </div>
</script>

<!-- ç»„ä»¶3 è§†é¢‘æ’­æ”¾ -->
<script type="text/html" id="videoPlay">
  <div class="video">
    <div class="title-wrapper">
      <span class='tag'>MV</span>
      <span class='title'>{{mvName}}</span>
      <span class='artist'>{{singer}}</span>
    </div>
    <video :src="mvUrl" controls></video>
  </div>
</script>


<!-- ç»„ä»¶4 æ­Œæ›²è¯„è®º -->
<script type="text/html" id="comment01">
  <div class="comment-wrapper">
    <div class="items">
      <div class="item">
        <div class="left">
          <img src="./img/icon.jpg" alt="">
        </div>
        <div class="right">
          <div class="top">
            <span class='user'>é˜¿æœ¨æœ¨:</span>
            <span
              class='content'>å†™æ­Œçš„äººå‡æ­£ç»ï¼Œå”±æ­Œçš„äººæœ€çŸ«æƒ…ï¼Œå¬æ­Œçš„äººæœ€ç”¨å¿ƒå†™æ­Œçš„äººå‡æ­£ç»ï¼Œå”±æ­Œçš„äººæœ€çŸ«æƒ…ï¼Œå¬æ­Œçš„äººæœ€ç”¨å¿ƒå†™æ­Œçš„äººå‡æ­£ç»ï¼Œå”±æ­Œçš„äººæœ€çŸ«æƒ…ï¼Œå¬æ­Œçš„äººæœ€ç”¨å¿ƒå†™æ­Œçš„äººå‡æ­£ç»ï¼Œå”±æ­Œçš„äººæœ€çŸ«æƒ…ï¼Œå¬æ­Œçš„äººæœ€ç”¨å¿ƒå†™æ­Œçš„äººå‡æ­£ç»ï¼Œå”±æ­Œçš„äººæœ€çŸ«æƒ…ï¼Œå¬æ­Œçš„äººæœ€ç”¨å¿ƒå†™æ­Œçš„äººå‡æ­£ç»ï¼Œå”±æ­Œçš„äººæœ€çŸ«æƒ…ï¼Œå¬æ­Œçš„äººæœ€ç”¨å¿ƒå†™æ­Œçš„äººå‡æ­£ç»ï¼Œå”±æ­Œçš„äººæœ€çŸ«æƒ…ï¼Œå¬æ­Œçš„äººæœ€ç”¨å¿ƒå†™æ­Œçš„äººå‡æ­£ç»ï¼Œå”±æ­Œçš„äººæœ€çŸ«æƒ…ï¼Œå¬æ­Œçš„äººæœ€ç”¨å¿ƒ</span>
          </div>
          <div class="bottom">
            <div class="time">2016å¹´9æœˆ18æ—¥</div>
            <div class="like-wrapper">
              <span>ğŸ‘</span>(6666)
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</script>

<!-- ç»„ä»¶5  æ¯æ—¥æ­Œæ›²æ¨è -->
<script type="text/html" id="recommendedSongs01">


</script>
<script>
  // 0. å¦‚æœä½¿ç”¨æ¨¡å—åŒ–æœºåˆ¶ç¼–ç¨‹ï¼Œå¯¼å…¥Vueå’ŒVueRouterï¼Œè¦è°ƒç”¨ Vue.use(VueRouter)

  // 1. å®šä¹‰ (è·¯ç”±) ç»„ä»¶ã€‚
  // å¯ä»¥ä»å…¶ä»–æ–‡ä»¶ import è¿›æ¥

  const searchTem = {

    template: '#search01',
    data() {
      return {
        musicList: [],
      }
    },
    created() {
      axios.get(`https://autumnfish.cn/search?keywords=${this.$route.params.query}`)
        .then(res => {
          console.log(res);
          this.musicList = res.data.result.songs
          console.log(this.musicList);
        })
    },
    filters: {
      singeres(value) {

        let singerList = ''

        for (let i = 0; i < value.length; i++) {

          singerList += value[i].name

          singerList += '/'

        }
        singerList = singerList.slice(0, -1)

        return singerList
      }



    },
    methods: {
      toPlay(id) {
        router.push(`/play/${id}`)
      },
      toMv(id) {
        router.push(`/mv/${id}`)

      }
    },
  }
  const playTem = {
    template: '#play01',
    data() {
      return {

        isloading:true,
        //æ­Œæ›²æ’­æ”¾åœ°å€

        musicUrl: '',

        //æ­Œæ›²å°é¢
        imgSrc: '',

        //æ­Œæ›²åç§°
        musicName: '',

        //æ­Œæ‰‹

        singerName: '',

        //ä¸“è¾‘åç§°

        specialName: '',

        //æ­Œè¯

        lyrics: []




      }
    },
    created() {
      //è·å–æ­Œæ›²æ’­æ”¾åœ°å€
      axios.get(`https://autumnfish.cn/song/url?id=${this.$route.params.id}`)
        .then(res => {
          console.log(res);
          this.musicUrl = res.data.data[0].url
          console.log(this.musicUrl);

        })
      //è·å–æ­Œæ›²è¯¦æƒ…
      axios.get(`https://autumnfish.cn/song/detail?ids=${this.$route.params.id}`)
        .then(res => {
          console.log(res);
          this.imgSrc = res.data.songs[0].al.picUrl
          this.musicName = res.data.songs[0].name
          this.singerName = res.data.songs[0].ar[0].name
          // console.log(this.singerName);
          this.specialName = res.data.songs[0].al.name

        })

      //è·å–æ­Œè¯

      axios.get(`https://autumnfish.cn/lyric?id=${this.$route.params.id}`)
        .then(res => {
          console.log(res);

          this.lyrics = res.data.lrc.lyric.split('\n')

          for (let i = 0; i < this.lyrics.length; i++) {
            this.lyrics[i] = this.lyrics[i].slice(11)
          }
        })

    },
methods: {
 
  play(){
    this.isloading=true

  },
  pause(){
    this.isloading=false
  }
},
  }

  const playVideo = {
    template: '#videoPlay',
    data() {
      return {
        //è§†é¢‘åœ°å€
        mvUrl: '',

        //mvåç§°

        mvName: '',

        //æ­Œæ‰‹

        singer: ''

      }

    },
    created() {
      // è·å–è§†é¢‘åœ°å€
      axios.get(`https://autumnfish.cn/mv/url?id=${this.$route.params.id}`)
        .then(res => {

          this.mvUrl = res.data.data.url
          // console.log(this.mvUrl);
        })

      // è·å–MVæ•°æ®
      axios.get(`https://autumnfish.cn/mv/detail?mvid=${this.$route.params.id}`)
        .then(res => {
          console.log(res);
          this.mvName = res.data.data.name
          this.singer = res.data.data.artistName

        })

    }
  }

  const commentTem = {
    template: '#comment01',
    created() {
      // è·å–æ­Œæ›²è¯„è®º
      //  axios.get(`https://autumnfish.cn/mv/url?id=${this.$route.params.id}`)
      //     .then(res => {

      //       this.mvUrl=res.data.data.url
      //       // console.log(this.mvUrl);
      //     })

    },
  }

  // const recommendedSongsTem = {
  //   template: '#recommendedSongs01',
  //   data() {
  //     return {

  //     }
  //   },
  //   methods: {
  //     add() {
  //       axios.get(`https://autumnfish.cn/recommend/songs`)
  //         .then(res => {
  //           console.log(res);

  //         })
  //     }
  //   },
  // }
  // 2. å®šä¹‰è·¯ç”±
  // æ¯ä¸ªè·¯ç”±åº”è¯¥æ˜ å°„ä¸€ä¸ªç»„ä»¶ã€‚ å…¶ä¸­"component" å¯ä»¥æ˜¯
  // é€šè¿‡ Vue.extend() åˆ›å»ºçš„ç»„ä»¶æ„é€ å™¨ï¼Œ
  // æˆ–è€…ï¼Œåªæ˜¯ä¸€ä¸ªç»„ä»¶é…ç½®å¯¹è±¡ã€‚
  // æˆ‘ä»¬æ™šç‚¹å†è®¨è®ºåµŒå¥—è·¯ç”±ã€‚
  const routes = [{
      //ä¸ºäº†èƒ½ä¼ é€’æ•°æ®  è§„åˆ™éœ€è¦å®šä¹‰ä¸º/search/:xx
      path: '/search/:query',
      component: searchTem
    },

    {
      path: '/play/:id',
      component: playTem
    },
    {
      path: '/mv/:id',
      component: playVideo
    },
    {
      path: '/comment/:id',
      component: commentTem
    },
    // {
    //   path: '/recommendedSongs',
    //   component: recommendedSongsTem
    // }

  ]

  // 3. åˆ›å»º router å®ä¾‹ï¼Œç„¶åä¼  `routes` é…ç½®
  // ä½ è¿˜å¯ä»¥ä¼ åˆ«çš„é…ç½®å‚æ•°, ä¸è¿‡å…ˆè¿™ä¹ˆç®€å•ç€å§ã€‚
  const router = new VueRouter({
    routes // (ç¼©å†™) ç›¸å½“äº routes: routes
  })

  // 4. åˆ›å»ºå’ŒæŒ‚è½½æ ¹å®ä¾‹ã€‚
  // è®°å¾—è¦é€šè¿‡ router é…ç½®å‚æ•°æ³¨å…¥è·¯ç”±ï¼Œ
  // ä»è€Œè®©æ•´ä¸ªåº”ç”¨éƒ½æœ‰è·¯ç”±åŠŸèƒ½
  const app = new Vue({
    el: "#player",
    router,
    data: {
      query: '',
      msg: 'é»‘é©¬éŸ³ä¹'
    },
    methods: {
      searchMusic() {
        //è·å–search  ç¼–ç¨‹å¼å¯¼èˆª
        console.log('ccc');

        router.push(`/search/${this.query}`)

      }
    },
  })

  // ç°åœ¨ï¼Œåº”ç”¨å·²ç»å¯åŠ¨äº†ï¼
</script>